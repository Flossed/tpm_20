<!DOCTYPE html>
<html lang="en">
<%- include('layouts/header'); -%>
   <body style="background-color: #FEFBE4;">   
   <%- include('layouts/heading'); -%>

    <main>
       <div class="container">
          <div class="row">
            <div class="col-12">
              <h1 class="display-4 text-center mb-5">TPM 2.0 Dashboard</h1>
              <p class="lead text-center mb-5">Secure key management and document signing using hardware TPM</p>
            </div>
          </div>
          
          <!-- Statistics Cards -->
          <div class="row mb-5">
            <div class="col-md-4">
              <div class="card text-center">
                <div class="card-body">
                  <i class="bi bi-shield-lock-fill display-4 text-primary mb-3"></i>
                  <h5 class="card-title">Active Keys</h5>
                  <h2 class="text-primary mb-3"><%= typeof keys !== 'undefined' ? keys.filter(k => k.status === 'active').length : 0 %></h2>
                  <a href="/keys" class="btn btn-outline-primary">Manage Keys</a>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="card text-center">
                <div class="card-body">
                  <i class="bi bi-file-earmark-text-fill display-4 text-success mb-3"></i>
                  <h5 class="card-title">Documents</h5>
                  <h2 class="text-success mb-3"><%= typeof documents !== 'undefined' ? documents.length : 0 %></h2>
                  <a href="/documents" class="btn btn-outline-success">View Documents</a>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="card text-center">
                <div class="card-body">
                  <i class="bi bi-pen-fill display-4 text-warning mb-3"></i>
                  <h5 class="card-title">Signatures</h5>
                  <h2 class="text-warning mb-3"><%= typeof signatures !== 'undefined' ? signatures.length : 0 %></h2>
                  <a href="/signatures" class="btn btn-outline-warning">View Signatures</a>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="row featurette">
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body d-flex flex-column">
                  <div class="text-center mb-4">
                    <i class="bi bi-key-fill display-1 text-primary"></i>
                  </div>
                  <h2 class="featurette-heading fw-normal text-center">Key Management</h2>
                  <p class="lead text-center flex-grow-1">
                    Create and manage ES256 keypairs using hardware TPM. 
                    Generate certificate signing requests and manage key lifecycle.
                  </p>
                  <div class="text-center mt-auto">
                    <a href="/keys" class="btn btn-primary btn-lg">Manage Keys</a>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body d-flex flex-column">
                  <div class="text-center mb-4">
                    <i class="bi bi-file-earmark-lock-fill display-1 text-success"></i>
                  </div>
                  <h2 class="featurette-heading fw-normal text-center">Document Signing</h2>
                  <p class="lead text-center flex-grow-1">
                    Upload documents and sign them with your TPM keys.
                    Verify signatures and maintain document integrity.
                  </p>
                  <div class="text-center mt-auto">
                    <a href="/documents" class="btn btn-success btn-lg">Sign Documents</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Recent Activity -->
          <% if (typeof recentActivity !== 'undefined' && recentActivity.length > 0) { %>
          <div class="row mt-5">
            <div class="col-12">
              <h3>Recent Activity</h3>
              <div class="card">
                <div class="card-body">
                  <div class="list-group list-group-flush">
                    <% recentActivity.forEach(function(activity) { %>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="mb-1"><%= activity.action %></h6>
                        <p class="mb-1"><%= activity.details %></p>
                        <small class="text-muted"><%= new Date(activity.timestamp).toLocaleString() %></small>
                      </div>
                      <span class="badge bg-<%= activity.type === 'key' ? 'primary' : activity.type === 'document' ? 'success' : 'warning' %> rounded-pill">
                        <%= activity.type %>
                      </span>
                    </div>
                    <% }); %>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <% } %>
       </div>
    </main>

    <%- include('layouts/footer'); -%>
    <script src="/js/dashboard.js"></script>
   </body>
</html>